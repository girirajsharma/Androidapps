//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){var i = Math.floor((y-disc_margY-top_marg)/tama_h);var j = Math.floor((x-disc_margX)/tama_w);if(i<0 || i>5 || j<0 || j>5){umaPos=[-1,-1];return;}$("top_info1").innerHTML = "";umaPos=[j,i];umaNum++;umaNum=umaNum%4;}function movePanelXY(x, y){if(x>120 && x<200 && y>5+top_marg && y<40+top_marg && touchtime!=0){touchtime=2;drawTama();return;}else if(touchtime!=0){touchtime=1;drawTama();return;}}function endPanelXY(){if(umaPos[0]==-1)return;drawTama();drawFrog(-1,-1);drawUma();if(value[umaPos[1]][umaPos[0]]==count){if(count!=qnum){count++;}else{timer=0;score++;ctx.drawImage(cimage, 0, 0, 320, 340, 0, 0, 320, 340);btnFlg=clear;flg = btnFlg;}}else{timer=0;btnFlg=over;flg = btnFlg;}}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>150 && y<185 && x>80 && x<240){btnFlg = start;}else if(y>285 && y<315 && x>80 && x<240){btnFlg = link;}else{btnFlg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>30 && y>150 && y<185 && x>80 && x<240){btnFlg = start;}else if(timer>30 && y>190 && y<225 && x>80 && x<240){btnFlg = link;}else if(timer>30 && y>230 && y<265 && x>80 && x<240){btnFlg = ready;}else if(timer>5 && y>280 && y<280+social_h && x>97 && x<97+social_w/2){btnFlg = tweet;}else if(timer>5 && y>280 && y<280+social_h && x>97+social_w/2 && x<97+social_w){btnFlg = face;}else{btnFlg = over;}}function clearButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>160 && y<190 && x>80 && x<240){btnFlg = next;}else{btnFlg = clear;}}function endButtonXY(){if(timer>5 && btnFlg==start){umaPos=[-1,-1];frogPos=[-1,-1];timer=0;flg = btnFlg;}else if(timer>5 && btnFlg==next){umaPos=[-1,-1];frogPos=[-1,-1];timer=0;count=1;umaNum=0;qnum=3+Math.floor(score/3);flg = btnFlg;}else if(timer>5 && btnFlg==ready){umaPos=[-1,-1];frogPos=[-1,-1];clearTama();valInit();drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);flg = btnFlg;btnFlg=="";}else if(timer>5 && btnFlg==link){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5 && btnFlg==tweet){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialtj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialt.php?id='+id+'&score='+s_score;}}else if(timer>5 && btnFlg==face){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialfj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialf.php?id='+id+'&score='+s_score;}}else if(timer>5){flg = btnFlg;}}function valInit(){var RAN=Math.floor(Math.random() * 6);var x = RAN;var y = 5;value[y][x] = 1;valCreate(x,y,1);}function valCreate(x,y,n){var direct = [[-2,-1],[-1,-2],[1,-2],[2,-1],[2,1],[1,2],[-1,2],[-2,1],[-1,0],[0,1],[1,0],[0,-1]];var koho=[];var t=0;for(var i=0;i<direct.length;i++){if(y+direct[i][0]>=0 && y+direct[i][0]<6 && x+direct[i][1]>=0 && x+direct[i][1]<6 && value[y+direct[i][0]][x+direct[i][1]]==0){koho[t] = [y+direct[i][0],x+direct[i][1]];t++;}}if(koho.length==0)return;var RAN=Math.floor(Math.random() * koho.length);value[koho[RAN][0]][koho[RAN][1]]= n+1;if(n<qnum-1){valCreate(koho[RAN][1],koho[RAN][0],n+1);return;}return;}function drawTama(){ctx.clearRect(0,0,320,320);ctx.drawImage(baseimage, 0, 0, 320, 320, 0, 0, 320, 320);for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(flg==over || flg==ready){if(i!=umaPos[1] || j!=umaPos[0])ctx.drawImage(dimage, (value[i][j]%3)*tama_w, Math.floor(value[i][j]/3)*tama_h, tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}else{ctx.drawImage(dimage, 0, 0, tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}}}}function drawUma(){if(umaPos[0]==-1){ctx.drawImage(umaimage, 0, 0, uma_w, uma_h, 20, 235, uma_w, uma_h);}else if(flg==clear){ctx.drawImage(umaimage, (4+Math.floor(timer/5)%2)*uma_w, 0, uma_w, uma_h, tama_w*umaPos[0]+disc_margX-(uma_w-tama_w-1)/2, tama_h*umaPos[1]+disc_margY-(uma_h-tama_h)+10, uma_w, uma_h);}else if(flg==over){ctx.drawImage(umaimage,  (6+Math.floor(timer/4)%2)*uma_w, 0, uma_w, uma_h, tama_w*umaPos[0]+disc_margX-(uma_w-tama_w-1)/2, tama_h*umaPos[1]+disc_margY-(uma_h-tama_h)+10, uma_w, uma_h);}else{ctx.drawImage(umaimage, umaNum*uma_w, 0, uma_w, uma_h, tama_w*umaPos[0]+disc_margX-(uma_w-tama_w-1)/2, tama_h*umaPos[1]+disc_margY-(uma_h-tama_h)+10, uma_w, uma_h);}}function drawFrog(j,i){if(i==-1){ctx.drawImage(dimage, 2*tama_w, 12*tama_h, tama_w, tama_h, 130, 270, tama_w, tama_h);}else if(flg==quest && timer%11<5){ctx.drawImage(dimage, 1*tama_w, 12*tama_h, tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY-3, tama_w, tama_h);}else{ctx.drawImage(dimage, 2*tama_w, 12*tama_h, tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY-3, tama_w, tama_h);}}function resetTama(){for (var i=0; i<4; i++) {for (var j=0; j<5; j++) {value[i][j] = bvalue[i][j];}}touchtime=0;}function clearTama(){value = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];bvalue = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];score=0;qnum=3+Math.floor(score/3);count=1;umaNum=0;}function Question(){if(syoritime!=0 && Math.floor(timer/11)==syoritime){drawTama();drawFrog(frogPos[0],frogPos[1]);drawUma();return true;}for(var m=0;m<6;m++){for(var n=0;n<6;n++){if(Math.floor(timer/11)==value[m][n]){frogPos[0]=n;frogPos[1]=m;drawTama();drawFrog(frogPos[0],frogPos[1]);drawUma();syoritime=Math.floor(timer/11);return true;}}}return false;}function Check(){for(var i=0;i<8;i++){for(var j=0;j<4;j++){if(value[i][j]!=0 && value[i][j]!=bvalue[i][j])return false;}}return true;}function ClearCheck(){for(var i=0;i<8;i++){for(var j=0;j<4;j++){if(value[i][j]!=bvalue[i][j])return false;}}return true;}function socialHenkan(){if(document.documentElement.lang == 'ja'){s_score=score+" ステージクリア! (^^)v 『"+title+"』";}else{s_score=score+" Stages Clear! ["+title+"]";}s_score=encodeURI(s_score);}
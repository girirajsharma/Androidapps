//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){$("top_info2").innerHTML = "";$("top_info2").style.display="none";if(turn==0 || turn==-1){bturn=1;}else if(turn==1){bturn=-1;}for(var i=0;i<2;i++){if(bombs[i][1]<=-bomb_h){bombs[i][0]=goei_x+10;bombs[i][1]=goei_y;bombs[i][2]=timer;return;}}}function endPanelXY(){turn=bturn;}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>140 && y<175 && x>80 && x<240){bflg = start;}else if(y>295 && y<315 && x>80 && x<240){bflg = link;}else{bflg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>145 && y<180 && x>80 && x<240){bflg = start;}else if(timer>5 && y>185 && y<220 && x>80 && x<240){bflg = link;}else if(timer>5 && y>225 && y<260 && x>80 && x<240){bflg = ready;}else{bflg = over;}}function endButtonXY(){if(timer>5 && bflg==start){ubvalue = [[-120,-50,-8.7,1.8],[-120,-70,-10,2.1],[450,-60,12,1.6]];bombs = [[0,-40,0],[0,-40,0]];timer= 0;score= 0;count= 3;turn = 0;goei_x = 0;flg = bflg;bflg="";}else if(timer>5 && bflg==ready){ubvalue = [[-120,-50,-8.7,1.8],[-120,-70,-10,2.1],[450,-60,12,1.6]];bombs = [[0,-40,0],[0,-40,0]];timer= 0;score= 0;count= 3;turn = 0;goei_x = 0;flg = bflg;bflg="";}else if(timer>5 && bflg==link){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5){flg = bflg;}}function drawBase(){var b = ctx.createLinearGradient(0,0,0,320);b.addColorStop(0.8, "rgba(255,255,255,1)");b.addColorStop(0.5, "rgba(100,220,255,1)");b.addColorStop(0.4, "rgba(20,220,255,1)");b.addColorStop(0.23, "rgba(100,220,255,1)");ctx.fillStyle = b;ctx.fillRect(0,0,320,320);ctx.drawImage(bimage, 0, 0, 320, 80, 0, 240, 320, 80);ctx.drawImage(fimage, 35*(Math.floor(timer/2)%3), 0, 35, 80, 30, -5, 35, 80);}function drawGoei(){if(goei_x<0){goei_x=0;}else if(goei_x>320-goei_w){goei_x=320-goei_w;}if(turn==0){ctx.drawImage(goimage, 0, 0, goei_w, goei_h, goei_x, goei_y, goei_w, goei_h);}else if(flg!=bomb && flg!=over){goei_x += turn*speed;ctx.drawImage(goimage, goei_w*(Math.floor(timer/2)%2+1), 0, goei_w, goei_h, goei_x, goei_y, goei_w, goei_h);return;}}function drawUboat(){for(var i=0;i<3;i++){ubvalue[i][0]+=ubvalue[i][2];ubvalue[i][1]+=ubvalue[i][3];if(ubvalue[i][2]>0){ctx.drawImage(ubimage, uboat_w*(timer%2+2), 0, uboat_w, uboat_h, ubvalue[i][0], ubvalue[i][1], uboat_w, uboat_h);}else{ctx.drawImage(ubimage, uboat_w*(timer%2), 0, uboat_w, uboat_h, ubvalue[i][0], ubvalue[i][1], uboat_w, uboat_h);}if(ubvalue[i][0]<0){ubvalue[i][0]=0;ubvalue[i][2]*=-1;}else if(ubvalue[i][0]>320-uboat_w){ubvalue[i][0]=320-uboat_w;ubvalue[i][2]*=-1;}if(ubvalue[i][1]>330){ubvalue[i][0]=Math.floor(Math.random()*100)+320;ubvalue[i][1]=Math.floor(Math.random()*30)-80;}}}function drawOj(){if(flg!=bomb && flg!=over){ctx.drawImage(ojimage, 0, 0, oj_w, oj_h, 200, 230, oj_w, oj_h);}else{ctx.drawImage(ojimage, oj_w, 0, oj_w, oj_h, 200, 230, oj_w, oj_h);}}function drawGyorai(){for(var i=0;i<3;i++){if(gyorai[i][1]==320)continue;gyorai[i][0]+=gyorai[i][2];gyorai[i][1]+=gyorai[i][3];if(gyorai[i][1]<50+gyorai_h)gyorai[i][1]=320;ctx.drawImage(gyoimage, 0, 0, gyorai_w, gyorai_h, gyorai[i][0], gyorai[i][1], gyorai_w, gyorai_h);}}function drawBomb(){for(var i=0;i<2;i++){if(bombs[i][1]==-bomb_h)continue;if(bombs[i][1]<-bomb_h)bombs[i][1]=-bomb_h;if(bombs[i][2]>timer-2){ctx.drawImage(boimage, (timer-bombs[i][2])*bomb_w, 0, bomb_w, bomb_h, bombs[i][0], bombs[i][1], bomb_w, bomb_h);}else{bombs[i][1]+=bspeed;ctx.drawImage(boimage, (2+timer%2)*bomb_w, 0, bomb_w, bomb_h, bombs[i][0], bombs[i][1], bomb_w, bomb_h);}}}function atariCheck(){for(var i=0;i<3;i++){if(ubvalue[i][0]+uboat_w-10<200 || ubvalue[i][0]>230+oj_w-10 || ubvalue[i][1]+uboat_h/3<230){continue;}else{ctx.drawImage(ubimage, uboat_w*4, 0, uboat_w, uboat_h, ubvalue[i][0], ubvalue[i][1], uboat_w, uboat_h);ubvalue[i][0]=Math.floor(Math.random()*100)+320;ubvalue[i][1]=Math.floor(Math.random()*30)-80;count--;if(count==0){flg=over;return;}timer=0;turn=0;$("top_info2").style.display="block";$("top_info2").innerHTML = "Touch the panel to restart !!";if(document.documentElement.lang == 'ja')$("top_info2").innerHTML = "パネルをタッチしてリスタート！";flg=bomb;return;}}}function bombCheck(){for(var i=0;i<3;i++){for(var j=0;j<2;j++){if(ubvalue[i][1]>320 || ubvalue[i][1]<-uboat_h)continue;if(bombs[j][1]==-40)continue;if(ubvalue[i][1]>bombs[j][1]+5 || ubvalue[i][1]+uboat_h-10<bombs[j][1])continue;if(ubvalue[i][0]<bombs[j][0] && ubvalue[i][0]>bombs[j][0]-bomb_w+5){ctx.drawImage(ubimage, uboat_w*4, 0, uboat_w, uboat_h, ubvalue[i][0], ubvalue[i][1], uboat_w, uboat_h);bombs[j][1]=-bomb_h;ubvalue[i][0]=Math.floor(Math.random()*100)+320;ubvalue[i][1]=Math.floor(Math.random()*30)-80;score+=10;}}}}
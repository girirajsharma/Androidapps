//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){selectXY[0] = Math.floor((x-disc_margX-disc_tumeX)/(tama_w-disc_tumeX));if(selectXY[0]<0 || selectXY[0]>5)return;selectX = x;if(selectX<disc_margX+tama_w/2)selectX=disc_margX+tama_w/2;if(selectX>disc_margX+tama_w*5+tama_w/2)selectX=disc_margX+tama_w*5+tama_w/2;selectY = 0;for(var i=0;i<6;i++){if(Board[i][selectXY[0]]!=0){selectXY[1]=i;select=Board[i][selectXY[0]]+3;Board[i][selectXY[0]]=0;flg=jump;return;}}}function movePanelXY(x,y){selectX = x;if(selectX<disc_margX+tama_w/2)selectX=disc_margX+tama_w/2;if(selectX>disc_margX+tama_w*5+tama_w/2)selectX=disc_margX+tama_w*5+tama_w/2;if(x<10 || x>310){endPanelXY();return;}}function endPanelXY(){var j = Math.floor((selectX-tama_w/2)/tama_w);for(var i=0;i<6;i++){if(Board[i][j]!=0){if(i>0)selectXY=[j,i-1];flg=down;return;}}selectXY=[j,5];flg=down;return;}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>145 && y<185 && x>80 && x<240){btnFlg = start;}else if(y>270 && y<315 && x>80 && x<240){btnFlg = link;}else{btnFlg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;ctx.clearRect(0,0,320,320);drawTama();if(timer>5 && y>175 && y<205 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 162, 160, 35);btnFlg = start;}else if(timer>5 && y>215 && y<245 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 202, 160, 35);btnFlg = link;}else if(timer>5 && y>255 && y<285 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 242, 160, 35);btnFlg = ready;}else{btnFlg = over;}ctx.drawImage(ovimage, 0, 0, 300, 300, 10, 20, 300, 300);ctx.drawImage(socialimage, 0, 0, social_w, social_h, 97, 280, social_w, social_h);}function clearButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>155 && y<185 && x>80 && x<240){drawTama();ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 90, 165, 140, 20);btnFlg = start;}else{drawTama();ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = clear;}}function overButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>155 && y<185 && x>80 && x<240){btnFlg = start;}else if(timer>5 && y>195 && y<225 && x>80 && x<240){btnFlg = link;}else if(timer>5 && y>235 && y<265 && x>80 && x<240){btnFlg = ready;}else if(timer>5 && y>280 && y<280+social_h && x>97 && x<97+social_w/2){btnFlg = tweet;}else if(timer>5 && y>280 && y<280+social_h && x>97+social_w/2 && x<97+social_w){btnFlg = face;}else{btnFlg = over;}}function endButtonXY(){if(timer>5 && btnFlg==start){timer=0;Board = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];ChackBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];zBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];sBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];New=[0,0,0,0,0,0];selectXY=[0,0];select = 0;selectX = 0;selectY = 0;dtime=0;limitime=100;overFlg=0;score=0;bcheck=0;change=0;flg = btnFlg;}else if(timer>5 && btnFlg==ready){timer=0;Board = [[ 0, 0,13, 0, 0, 0],[23, 0, 0, 0, 0,53],[ 0, 0, 0, 0,60, 0],[50,60, 0, 0,40,30],[20,30,30,50,10,50],[50,60,40,60,50,30]];ChackBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];zBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];sBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];New=[0,0,0,0,0,0];selectXY=[0,0];select = 0;selectX = 0;selectY = 0;dtime=0;limitime=100;score=0;bcheck=0;change=0;drawBase();drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);$("rinfo").innerHTML = "";$("linfo").innerHTML = "";flg = btnFlg;}else if(timer>5 && btnFlg==link){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5 && btnFlg==tweet){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialtj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialt.php?id='+id+'&score='+s_score;}}else if(timer>5 && btnFlg==face){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialfj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialf.php?id='+id+'&score='+s_score;}}else if(timer>5){flg = btnFlg;}}function initBlock(){for(var i=4;i<6;i++){for(var j=0;j<6;j++){var color=[10,20,30,40,50,60];do{var RAN=Math.floor(Math.random()*color.length);Board[i][j]=color[RAN];color.splice(RAN,1);num=0;LineCheck(j, i);for(var m=0;m<6;m++){for(var n=0;n<6;n++){ChackBoard[m][n]=0;}}}while(num>2);}}}function LineCheck(px, py){ChackBoard[ py ][ px ] = -1;num++;if (px!=5 && (Board[ py ][ px ]-Board[ py ][ px ]%10) == (Board[ py ][ px+1 ]-Board[ py ][ px+1 ]%10) && ChackBoard[ py ][ px+1 ] == 0)LineCheck( px+1, py );if (px!=0 && (Board[ py ][ px ]-Board[ py ][ px ]%10) == (Board[ py ][ px-1 ]-Board[ py ][ px-1 ]%10) && ChackBoard[ py ][ px-1 ] == 0)LineCheck( px-1, py );if (py!=5 && (Board[ py ][ px ]-Board[ py ][ px ]%10) == (Board[ py+1 ][ px ]-Board[ py+1 ][ px ]%10) && ChackBoard[ py+1 ][ px ] == 0)LineCheck( px, py+1 );if (py!=0 && (Board[ py ][ px ]-Board[ py ][ px ]%10) == (Board[ py-1 ][ px ]-Board[ py-1 ][ px ]%10) && ChackBoard[ py-1 ][ px ] == 0)LineCheck( px, py-1 );}function drawBase(){ctx.drawImage(backimage, 0, 0, 320, 320, 0, 0, 320, 320);}function drawTama(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0){if(Board[i][j]%10==0){ctx.drawImage(oyimage, tama_w*((Board[i][j]-10)%10), tama_h*Math.floor((Board[i][j]-10)/10), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i+disc_margY, tama_w, tama_h);}else{ctx.drawImage(oyimage, tama_w*((Board[i][j]-10)%10+(Math.floor(timer/2))%2), tama_h*Math.floor((Board[i][j]-10)/10), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i+disc_margY, tama_w, tama_h);}}}}}function drawZure(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(zBoard[i][j]!=0)ctx.drawImage(oyimage, tama_w*((zBoard[i][j]-10)%10), tama_h*Math.floor((zBoard[i][j]-10)/10), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i+tama_h/2, tama_w, tama_h);}}}function LineDrop(){do{change=0;for(var i=0;i<5;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0 && Board[i+1][j]==0){for(var m=i;m>-1;m--){Board[m+1][j] = Board[m][j];}Board[0][j] =0;change++;}}}}while(change!=0);}function drawZure2(){ctx.clearRect(0,0,320,320);var b = ctx.createLinearGradient(0,0,0,320);b.addColorStop(0, "rgba(0,51,255,0.6)");b.addColorStop(1, "rgba(225,255,255,0.6)");ctx.fillStyle = b;ctx.fillRect(0,0,320,320);ctx.fillStyle = "#0c0";ctx.fillRect(0,310,320,320);for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0)ctx.drawImage(oyimage, tama_w*((Board[i][j]-1)%5), tama_h*Math.floor((Board[i][j]-1)/5), tama_w, tama_h-2, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i+tama_h/5, tama_w, tama_h);}}for(var j=0;j<6;j++){if(Select[j]!=0)ctx.drawImage(oyimage, tama_w*((Select[j]-1)%5), tama_h*Math.floor((Select[j]-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, select_margY+jumpY, tama_w, tama_h);}}function OneLine(){for(j=0;j<6;j++){var color=[13,23,33,43,53,63];do{RAN=Math.floor(Math.random()*color.length);New[j]=color[RAN];color.splice(RAN,1);if(Board[5][j]==0){Board[5][j]=New[j];num=0;LineCheck(j, 5);if(num>2)Board[5][j]=0;}else{for(i=0;i<6;i++){if(Board[i][j]!=0){if(i==0){overFlg=1;break;}else{Board[i-1][j]=New[j];num=0;LineCheck(j, i-1);if(num>2)Board[i-1][j]=0;break;}}}}for(m=0;m<6;m++){for(n=0;n<6;n++){ChackBoard[m][n]=0;}}}while(num>2);}for(j=0;j<6;j++){for(i=0;i<6;i++){if(Board[i][j]!=0 && Board[i][j]%10!=0){Board[i][j]=0;break;}}}}function socialHenkan(){if(document.documentElement.lang == 'ja'){s_score="スコア:"+score+"! 『"+title+"』";}else{s_score="SCORE:"+score+"! ["+title+"]";}s_score=encodeURI(s_score);}
//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
setInterval(timeProg,80);function timeProg(){timer++;offsetX(canvas);offsetY(canvas);if(gametime<1000 && flg!=over && flg!=clear){drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(socialimage, 0, 0, social_w, social_h, 97, 280, social_w, social_h);stoptime=0;$("rinfo").innerHTML = score+" / "+(Stage+2);$("linfo").innerHTML = "Time " + stoptime;$("minfo").innerHTML = "HURRY UP!";timer=0;flg=over;}if(Math.floor(gametime/1200)<10 && flg!=clear && flg!=over){if(timer%10==0 && $("minfo").innerHTML == ""){$("minfo").innerHTML = "HURRY UP!";}else if(timer%10==0 && $("minfo").innerHTML != ""){$("minfo").innerHTML = "";}}if(flg==open){if(!ctx){alert("Let's Play the game with HTML5 browser!");if(document.documentElement.lang == 'ja')alert("HTML5対応ブラウザで遊んでねっ");flg =error2;}QuestionCreate(Stage);flg=ready;}else if(flg==ready){if(btnFlg==""){drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);}$("rinfo").innerHTML = "";$("linfo").innerHTML = "";$("minfo").innerHTML = "";}else if(flg==start){QuestionCreate(Stage);drawTama();$("rinfo").innerHTML = score+" / "+(Stage+2);$("linfo").innerHTML = "Time " + Math.floor(gametime/1200);if(Stage==1){if(document.documentElement.lang == 'ja'){$("minfo").innerHTML = "トイレとタンクを繋げて!";}else{$("minfo").innerHTML = "Joint a man and tanks!";}}var date_obj = new Date();time = date_obj.getTime();btnFlg="";flg=touch;}else if(flg==touch){createTime();drawTama();$("rinfo").innerHTML = score+" / "+(Stage+2);$("linfo").innerHTML = "Time " + Math.floor(gametime/1200);}else if(flg==del){createTime();drawTama();if(timer>5){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(bBoard[i][j]!=0){if(i!=0){for(var m=i-1;m>=0;m--){if(Board[m][j]!=0 && m!=5)slideValue[m+1][j]=Board[m][j];Board[m][j] = 0;}}Board[i][j] = 0;var RAN=Math.floor(Math.random() * 9)+1;slideValue[0][j] = RAN;}}}drawTama();timer = 0;flg=drop;}}else if(flg==drop){createTime();if(timer<3){drawSlide();}else{for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==0)Board[i][j] = slideValue[i][j];}}for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==0){for(var m=i;m>0;m--){Board[m][j]=Board[m-1][j];}var RAN=Math.floor(Math.random() * 9)+1;Board[0][j] = RAN;}if(bBoard[i][j]!=0){bBoard[i][j]=0;}slideValue[i][j]=0;}}drawTama();score--;if(score==0){drawTama();ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);stoptime=Math.floor(gametime/1200);if(stoptime<0)stoptime=0;$("rinfo").innerHTML = score+" / "+(Stage+2);$("linfo").innerHTML = "Time " + Math.floor(gametime/1200);Stage++;$("minfo").innerHTML = "";flg=clear;return;}linkEnd=[-1,-1];discCheck();if(linkEnd[0]!=-1){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(bBoard[i][j]==1)Board[i][j]+=30;}}drawTama();timer=0;flg = del;}else{flg=touch;}}}else if(flg==clear){}else if(flg==over){}else if(flg==error2){}}
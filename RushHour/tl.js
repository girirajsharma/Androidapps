//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
setInterval(timeProg,100);function timeProg(){timer++;dtime++;offsetX(canvas);offsetY(canvas);if(flg==open){if(!ctx){alert("Let's Play the game with HTML5 browser!");if(document.documentElement.lang == 'ja')alert("HTML5対応ブラウザで遊んでねっ");flg =error2;}initBlock();drawBase();flg=ready;}else if(flg==ready){drawBase();drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);if(btnFlg == start){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 165, 150, 20);}else if(btnFlg == link){ctx.drawImage(aimage, 0, 0, 250, 50, 90, 302, 130, 10);}$("rinfo").innerHTML = "";$("linfo").innerHTML = "";}else if(flg==start){if(timer>4){initBlock();drawBase();drawTama();timer=0;$("rinfo").innerHTML = "Score " + score;flg=touch;}}else if(flg==touch){if(score>=1000 && score<2000){limitime=70;}else if(score>=2000){limitime=50;}if(dtime>limitime){OneLine();timer=0;selectY=-tama_h;flg = zure2;return;}drawBase();drawTama();$("rinfo").innerHTML = "Score " + score;}else if(flg==jump){drawBase();ctx.drawImage(oyimage, tama_w*((select-10)%10+(Math.floor(timer/2))%2), tama_h*Math.floor((select-10)/10), tama_w, tama_h, selectX-tama_w/2, selectY, tama_w, tama_h);drawTama();$("rinfo").innerHTML = "Score " + score;}else if(flg==down){drawBase();ctx.drawImage(oyimage, tama_w*((select-10)%10+(Math.floor(timer/2))%2), tama_h*Math.floor((select-10)/10), tama_w, tama_h, tama_w*selectXY[0]+disc_margX, selectY, tama_w, tama_h);drawTama();selectY+=30;var i = Math.floor((selectY+disc_tumeY-disc_margY)/(tama_h-disc_tumeY));if((i!=5 && Board[i+1][selectXY[0]]!=0) || i==5){Board[i][selectXY[0]]=select;Board[i][selectXY[0]]-=Board[i][selectXY[0]]%10;drawBase();drawTama();flg=check;}$("rinfo").innerHTML = "Score " + score;}else if(flg==check){drawBase();drawTama();bcheck=0;for(var i=0;i<6;i++){for(var j=0;j<6;j++){num=0;if(Board[i][j]!=0){LineCheck(j,i);if(num>2){for(var m=0;m<6;m++){for(var n=0;n<6;n++){if(ChackBoard[m][n]==-1){if(Board[m][n]%10==0)Board[m][n]++;ChackBoard[m][n]=0;}}}bcheck=1;}else{for(var m=0;m<6;m++){for(var n=0;n<6;n++){ChackBoard[m][n]=0;}}}}}}if(bcheck==1){change=0;timer=0;flg = del;}else{flg = touch;}$("rinfo").innerHTML = "Score " + score;}else if(flg==del){drawBase();drawTama();if(timer>6){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]%10>0){Board[i][j]=0;score += 10;}}}var bzure=0;for(var i=0;i<5;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0 && Board[i+1][j]==0){bzure=1;for(var m=i;m>-1;m--){zBoard[m][j] = Board[m][j];Board[m][j] = 0;}}}}if(bzure==1){timer=0;flg = zure;}else{for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(zBoard[i][j]!=0){zBoard[i][j]=0;}}}flg = touch;}}$("rinfo").innerHTML = "Score " + score;}else if(flg==zure){drawBase();if(timer<2){drawZure();drawTama();}else{for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(zBoard[i][j]!=0){Board[i][j] =zBoard[i][j];zBoard[i][j]=0;}}}LineDrop();drawTama();bcheck=0;change=0;flg = check;}$("rinfo").innerHTML = "Score " + score;}else if(flg==zure2){drawBase();drawTama();selectY+=30;var dropNum=0;for(j=0;j<6;j++){if(New[j]==0)dropNum++;if(New[j]!=0)ctx.drawImage(oyimage, tama_w*((New[j]-10)%10+(Math.floor(timer/2))%2), tama_h*Math.floor((New[j]-10)/10), tama_w, tama_h, tama_w*j+disc_margX, selectY, tama_w, tama_h);var i = Math.floor((selectY+disc_tumeY-disc_margY)/(tama_h-disc_tumeY));if(i==0 && overFlg==1){drawTama();if(j==5){timer = 0;btnFlg = over;flg=btnFlg;return;}}if(dropNum==6){dtime=0;flg=touch;return;}if(New[j]==0)continue;if((i!=5 && Board[i+1][j]!=0 && overFlg==0) || (i==5 && overFlg==0)){Board[i][j]=New[j]-3;New[j]=0;dropNum++;if(dropNum==6){dtime=0;flg=touch;return;}}}}else if(flg==over){drawBase();drawBase();for(var j=0;j<6;j++){ctx.drawImage(oyimage, tama_w*((New[j]-10)%10+(Math.floor(timer/2))%2), tama_h*Math.floor((New[j]-10)/10), tama_w, tama_h, tama_w*j+disc_margX, selectY, tama_w, tama_h);}drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);if(timer>5 && btnFlg==start){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 152, 160, 35);}else if(timer>5 && btnFlg==link){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 192, 160, 35);}else if(timer>5 && btnFlg==ready){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 230, 160, 35);}else if(btnFlg == tweet){ctx.drawImage(aimage, 0, 0, 250, 50, 92, 275, social_w/2+5, social_h+8);}else if(btnFlg == face){ctx.drawImage(aimage, 0, 0, 250, 50, 97+social_w/2, 275, social_w/2+5, social_h+8);}ctx.drawImage(socialimage, 0, 0, social_w, social_h, 97, 280, social_w, social_h);}else if(flg==error2){}}
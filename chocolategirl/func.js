//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){$("top_info1").innerHTML = "";var i = Math.floor((y-disc_margY-top_marg)/tama_h);var j = Math.floor((x-disc_margX)/tama_w);if(i<0)i=0;if(i>5)i=5;if(j<0)j=0;if(j>5)j=5;selectXY=[j,i];}function endPanelXY(){Board[selectXY[1]][selectXY[0]]=Rotate[Board[selectXY[1]][selectXY[0]]];if(Girl[selectXY[1]][selectXY[0]]!=0){Girl[selectXY[1]][selectXY[0]] = Board[selectXY[1]][selectXY[0]];gDirect++;if(gDirect==4)gDirect=0;}}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>155 && y<185 && x>80 && x<240){btnFlg = start;}else if(y>295 && y<315 && x>80 && x<240){btnFlg = link;}else{btnFlg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>153 && y<183 && x>80 && x<240){btnFlg = start;}else if(timer>5 && y>195 && y<225 && x>80 && x<240){btnFlg = link;}else if(timer>5 && y>235 && y<275 && x>80 && x<240){btnFlg = open;}else{btnFlg = over;}}function clearButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>155 && y<185 && x>80 && x<240){btnFlg = start;}else if(timer>5 && y>195 && y<225 && x>80 && x<240){btnFlg = link;}else if(timer>5 && y>235 && y<275 && x>80 && x<240){btnFlg = open;}else{btnFlg = clear;}}function endButtonXY(){if(timer>5 && btnFlg==start){Board=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Girl=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[1,0,0,0,0,0]];Goal=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];selectXY=[0,0];gDirect= 0;gSpeed=3;girlNum= 0;timer = 0;timerg= 0;flg = btnFlg;}else if(timer>5 && btnFlg==ready){Board=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Girl=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[1,0,0,0,0,0]];Goal=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];selectXY=[0,0];gDirect= 0;gSpeed=3;girlNum= 0;timer = 0;timerg= 0;setRoad();ctx.clearRect(0,0,320,320);drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);flg = btnFlg;}else if(timer>5 && btnFlg==link){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5){flg = btnFlg;}}function drawTama(){drawWaku();for(var i=0;i<6;i++){for(var j=0;j<6;j++){ctx.drawImage(dimage, tama_w*(Board[i][j]%4), tama_h*Math.floor(Board[i][j]/4), tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}}}function drawWaku(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){ctx.save();ctx.translate(tama_w*(j+1/2)+disc_margX, tama_h*(i+1/2)+disc_margY);ctx.beginPath();ctx.moveTo(-tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,tama_h/2);ctx.lineWidth=0.5;ctx.strokeStyle="#fff";ctx.stroke();ctx.restore();}}}function setRoad(){var Num=[1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,6,6,7,7,7,7,7,7,7];for(var i=0;i<6;i++){for(var j=0;j<6;j++){var RAN=Math.floor(Math.random() * Num.length);Board[i][j] = Num[RAN];Num.splice(RAN,1);}}Board[5][0]=4;Board[5][1]=4;var Points=[[1,0],[1,2],[1,4],[2,1],[2,3],[2,5],[3,0],[3,2],[3,4],[4,1],[4,3],[4,5],[5,4]];for(i=0;i<5;i++){var RAN=Math.floor(Math.random()*Points.length);Goal[Points[RAN][0]][Points[RAN][1]] = (i+1)*10;Points.splice(RAN,1);}}function drawGoal(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Goal[i][j]!=0){if(Goal[i][j]%10==0){ctx.drawImage(bimage, 0, tama_h*(Goal[i][j]/10), tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}else{ctx.drawImage(bimage,  tama_w*((Math.floor(timerg/3)%4)+1), tama_h*Math.floor(Goal[i][j]/10), tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}}}}}function girlRun(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Girl[i][j]==1){if(gDirect==0){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, timerg*gSpeed+tama_w*j-(tama_w+1)/2+disc_margX, tama_h*i-(tama_h+1)/2+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(0);timerg=0;return;}}else if(gDirect==1){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, tama_w*j+disc_margX, timerg*gSpeed+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(1);timerg=0;return;}}else if(gDirect==2){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, -timerg*gSpeed+tama_w*j+(tama_w+1)/2+disc_margX, tama_h*i-(tama_h+1)/2+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(2);timerg=0;return;}}else if(gDirect==3){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, tama_w*j+disc_margX, -timerg*gSpeed+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(3);timerg=0;return;}}}if(Girl[i][j]==2){if(gDirect==2){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, -Math.floor(tama_w/2*Math.cos(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_w*j+(tama_w+1)/2+disc_margX, Math.floor(tama_h/2*Math.sin(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(1);timerg=0;return;}}else if(gDirect==3){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, Math.floor(tama_w/2*Math.cos(-2*Math.PI/300*timerg*gSpeed-2*Math.PI/2))+tama_w*j+(tama_w+1)/2+disc_margX, -Math.floor(tama_h/2*Math.sin(-2*Math.PI/300*timerg*gSpeed-2*Math.PI/2))+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(0);timerg=0;return;}}}if(Girl[i][j]==3){if(gDirect==0){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, Math.floor(tama_w/2*Math.cos(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_w*j-(tama_w+1)/2+disc_margX, Math.floor(tama_h/2*Math.sin(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(1);timerg=0;return;}}else if(gDirect==3){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, Math.floor(tama_w/2*Math.cos(-2*Math.PI/300*timerg*gSpeed))+tama_w*j-(tama_w+1)/2+disc_margX, Math.floor(tama_h/2*Math.sin(-2*Math.PI/300*timerg*gSpeed))+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(2);timerg=0;return;}}}if(Girl[i][j]==4){if(gDirect==0){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, timerg*gSpeed+tama_w*j-(tama_w+1)/2+disc_margX, tama_h*i-(tama_h+1)/2+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(0);timerg=0;return;}}else if(gDirect==2){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, -timerg*gSpeed+tama_w*j+(tama_w+1)/2+disc_margX, tama_h*i-(tama_h+1)/2+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(2);timerg=0;return;}}}if(Girl[i][j]==5){if(gDirect==1){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, tama_w*j+disc_margX, timerg*gSpeed+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(1);timerg=0;return;}}else if(gDirect==3){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, tama_w*j+disc_margX, -timerg*gSpeed+tama_h*i+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg*gSpeed>tama_w){girlTranse(3);timerg=0;return;}}}if(Girl[i][j]==6){if(gDirect==1){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, Math.floor(tama_w/2*Math.cos(-2*Math.PI/300*timerg*gSpeed+2*Math.PI/2))+tama_w*j+(tama_w-1)/2+disc_margX, Math.floor(tama_h/2*Math.sin(-2*Math.PI/300*timerg*gSpeed+2*Math.PI/2))+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(0);timerg=0;return;}}else if(gDirect==2){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, -Math.floor(tama_w/2*Math.cos(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_w*j+(tama_w-1)/2+disc_margX, -Math.floor(tama_h/2*Math.sin(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(3);timerg=0;return;}}}if(Girl[i][j]==7){if(gDirect==0){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, Math.floor(tama_w/2*Math.cos(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_w*j-(tama_w-1)/2+disc_margX, -Math.floor(tama_h/2*Math.sin(2*Math.PI/300*timerg*gSpeed-2*Math.PI/4))+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(3);timerg=0;return;}}else if(gDirect==1){if(Goal[i][j]==0)drawGoal();ctx.drawImage(bimage, tama_w*((Math.floor(timerg/3)%2)+girlNum), 0, tama_w, tama_h, -Math.floor(tama_w/2*Math.cos(-2*Math.PI/300*timerg*gSpeed+2*Math.PI/2))+tama_w*j-(tama_w-1)/2+disc_margX, Math.floor(tama_h/2*Math.sin(-2*Math.PI/300*timerg*gSpeed+2*Math.PI/2))+tama_h*i-tama_h+disc_margY, tama_w, tama_h);if(Goal[i][j]!=0)drawGoal();if(timerg>75/gSpeed){girlTranse(2);timerg=0;return;}}}}}}function girlTranse(t){gDirect = t;for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Girl[i][j]!=0){if(Goal[i][j]!=0){Goal[i][j]=0;if(clearCheck()){btnFlg = clear;flg = clear;return;}}if(gDirect==0 && j!=5){if(Road[Board[i][j+1]][gDirect]==4){timerg = 0;flg = overInit;return;}Girl[i][j]=0;Girl[i][j+1]=Board[i][j+1];if(Goal[i][j+1]==0){girlNum=0;}else{Goal[i][j+1]++;girlNum=2;}return;}else if(gDirect==1 && i!=5){if(Road[Board[i+1][j]][gDirect]==4){timerg = 0;flg = overInit;return;}Girl[i][j]=0;Girl[i+1][j]=Board[i+1][j];if(Goal[i+1][j]==0){girlNum=0;}else{Goal[i+1][j]++;girlNum=2;}return;}else if(gDirect==2 && j!=0){if(Road[Board[i][j-1]][gDirect]==4){timerg = 0;flg = overInit;return;}Girl[i][j]=0;Girl[i][j-1]=Board[i][j-1];if(Goal[i][j-1]==0){girlNum=0;}else{Goal[i][j-1]++;girlNum=2;}return;}else if(gDirect==3 && i!=0){if(Road[Board[i-1][j]][gDirect]==4){timerg = 0;flg = overInit;return;}Girl[i][j]=0;Girl[i-1][j]=Board[i-1][j];if(Goal[i][j]!=0)Goal[i][j]=0;if(Goal[i-1][j]==0){girlNum=0;}else{Goal[i-1][j]++;girlNum=2;}return;}else{timerg = 0;flg = overInit;return;}}}}}function clearCheck(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Goal[i][j]!=0)return false;}}return true;}
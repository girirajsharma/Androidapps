//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){selectX = Math.floor((x-disc_margX-disc_tumeX)/(tama_w-disc_tumeX));return;}function movePanelXY(x,y){if(hitCheck(selectXY[1],selectXY[0] + Math.floor((x-selectX)/tama_w),select)){if(timer%speed==0)selectXY[0] += Math.floor((x-selectX)/tama_w);ctx.clearRect(0,0,320,320);drawTama();drawNext(nextBlock);drawSelect(selectXY[0],selectXY[1],select);}}function movePanelXYs(x,y){if(Math.abs(x-selectX) >= Math.abs(y-selectY)){if(hitCheck(selectXY[1],selectXY[0] + Math.floor((x-selectX)/tama_w),select)){selectXY[0] += Math.floor((x-selectX)/tama_w);ctx.clearRect(0,0,320,320);drawTama();drawNext(nextBlock);drawSelect(selectXY[0],selectXY[1],select);}}else if(Math.abs(x-selectX) < Math.abs(y-selectY) && y>selectY){if(hitCheck(selectXY[1] + Math.floor((y-selectY)/tama_h),selectXY[0],select)){selectXY[1] += Math.floor((y-selectY)/tama_h);ctx.clearRect(0,0,320,320);drawTama();drawNext(nextBlock);drawSelect(selectXY[0],selectXY[1],select);}}}function endPanelXY(){for(var j=0;j<6;j++){if(Select[j]!=0){if(j<selectX && j!=5){Select[j+1]=12;Select[j]=0;selectX=6;return;}else if(j>selectX && j!=0){Select[j-1]=13;Select[j]=0;selectX=-1;return;}else{Select[j]=14;for(i=6;i>=0;i--){if(Board[i][j]!=0){selectY=i;jumpY-=jumpSp;numY=5;flg=jump;return;}}}}}}function endTurnXY(){for(var j=0;j<6;j++){if(Select[j]!=0){if(j<selectX && j!=5){Select[j+1]=22;Select[j]=0;selectX=6;return;}else if(j>selectX && j!=0){Select[j-1]=23;Select[j]=0;selectX=-1;return;}else{if(Board[6][j]!=0)return;for(i=5;i>=0;i--){if(Board[i][j]!=0){selectY=i+1;bjumpY-=jumpSp;numY=5;Select[j]=14;flg=release;return;}}if(Board[0][j]==0){selectY=0;bjumpY-=jumpSp;numY=5;Select[j]=14;flg=release;return;}}}}}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>145 && y<185 && x>80 && x<240){drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 80, 165, 150, 20);btnFlg = start;}else if(y>270 && y<315 && x>80 && x<240){drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 90, 302, 130, 10);btnFlg = link;}else{drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>175 && y<205 && x>80 && x<240){ctx.clearRect(0,0,320,320);drawTama();drawBlock();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 162, 160, 35);ctx.drawImage(ovimage, 0, 0, 300, 300, 10, 20, 300, 300);btnFlg = start;}else if(timer>5 && y>215 && y<245 && x>80 && x<240){ctx.clearRect(0,0,320,320);drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 202, 160, 35);ctx.drawImage(ovimage, 0, 0, 300, 300, 10, 20, 300, 300);btnFlg = link;}else if(timer>5 && y>255 && y<285 && x>80 && x<240){ctx.clearRect(0,0,320,320);drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 242, 160, 35);ctx.drawImage(ovimage, 0, 0, 300, 300, 10, 20, 300, 300);btnFlg = ready;}else{ctx.clearRect(0,0,320,320);drawTama();ctx.drawImage(ovimage, 0, 0, 300, 300, 10, 20, 300, 300);btnFlg = over;}}function clearButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>155 && y<185 && x>80 && x<240){drawTama();ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 90, 165, 140, 20);btnFlg = start;}else{drawTama();ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = clear;}}function overButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(timer>5 && y>155 && y<185 && x>80 && x<240){drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 80, 152, 160, 35);btnFlg = start;}else if(timer>5 && y>195 && y<225 && x>80 && x<240){drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 80, 192, 160, 35);btnFlg = link;}else if(timer>5 && y>235 && y<265 && x>80 && x<240){drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 80, 230, 160, 35);btnFlg = ready;}else{drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = over;}}function endButtonXY(){if(timer>5 && btnFlg==start){timer=0;Board = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];ChackBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];zBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];sBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Select=[11,0,0,0,0,0];select = 0;selectX = 0;selectY = 0;dtime=0;limitime=100;score=0;jumpY=0;bjumpY=0;bcheck=0;change=0;flg = btnFlg;}else if(timer>5 && btnFlg==ready){timer=0;Board = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];ChackBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];zBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];sBoard = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Select=[11,0,0,0,0,0];select = 0;selectX = 0;selectY = 0;dtime=0;limitime=100;score=0;jumpY=0;bjumpY=0;bcheck=0;change=0;initBlock();drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);$("rinfo").innerHTML = "";$("linfo").innerHTML = "";flg = btnFlg;}else if(timer>5 && btnFlg==link){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5){flg = btnFlg;}}function initBlock(){for(var i=0;i<2;i++){for(var j=0;j<6;j++){var color=[1,2,3,4,5];do{var RAN=Math.floor(Math.random()*color.length);Board[i][j]=color[RAN];color.splice(RAN,1);num=0;LineCheck(j, i);for(var m=0;m<6;m++){for(var n=0;n<6;n++){ChackBoard[m][n]=0;}}}while(num>2);}}}function LineCheck(px, py){ChackBoard[ py ][ px ] = -1;num++;if (px!=5 && Board[ py ][ px ] == Board[ py ][ px+1 ] && ChackBoard[ py ][ px+1 ] == 0)LineCheck( px+1, py );if (px!=0 && Board[ py ][ px ] == Board[ py ][ px-1 ] && ChackBoard[ py ][ px-1 ] == 0)LineCheck( px-1, py );if (py!=6 && Board[ py ][ px ] == Board[ py+1 ][ px ] && ChackBoard[ py+1 ][ px ] == 0)LineCheck( px, py+1 );if (py!=0 && Board[ py ][ px ] == Board[ py-1 ][ px ] && ChackBoard[ py-1 ][ px ] == 0)LineCheck( px, py-1 );}function drawTama(){ctx.clearRect(0,0,320,320);var b = ctx.createLinearGradient(0,0,0,320);b.addColorStop(0, "rgba(0,51,255,0.6)");b.addColorStop(1, "rgba(225,255,255,0.6)");ctx.fillStyle = b;ctx.fillRect(0,0,320,320);ctx.fillStyle = "#0c0";ctx.fillRect(0,310,320,320);for(var i=0;i<8;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0)ctx.drawImage(oyimage, tama_w*((Board[i][j]-1)%5), tama_h*Math.floor((Board[i][j]-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i, tama_w, tama_h);}}for(var j=0;j<6;j++){if(Select[j]!=0)ctx.drawImage(oyimage, tama_w*((Select[j]-1)%5), tama_h*Math.floor((Select[j]-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, select_margY+jumpY, tama_w, tama_h);}}function drawBaloon(){for(var j=0;j<6;j++){if(Select[j]!=0)ctx.drawImage(oyimage, tama_w*((bSelect-1)%5), tama_h*Math.floor((bSelect-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, select_margY+bjumpY, tama_w, tama_h);}}function drawZure(){for(var i=0;i<7;i++){for(var j=0;j<6;j++){if(zBoard[i][j]!=0)ctx.drawImage(oyimage, tama_w*((zBoard[i][j]-1)%5), tama_h*Math.floor((zBoard[i][j]-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i-tama_h/2, tama_w, tama_h);}}}function LineDrop(){do{change=0;for(var i=1;i<7;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0 && Board[i-1][j]==0){for(var m=i;m<7;m++){Board[m-1][j] = Board[m][j];}Board[6][j] =0;change++;}}}}while(change!=0);}function drawZure2(){ctx.clearRect(0,0,320,320);var b = ctx.createLinearGradient(0,0,0,320);b.addColorStop(0, "rgba(0,51,255,0.6)");b.addColorStop(1, "rgba(225,255,255,0.6)");ctx.fillStyle = b;ctx.fillRect(0,0,320,320);ctx.fillStyle = "#0c0";ctx.fillRect(0,310,320,320);for(var i=0;i<7;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0)ctx.drawImage(oyimage, tama_w*((Board[i][j]-1)%5), tama_h*Math.floor((Board[i][j]-1)/5), tama_w, tama_h-2, (tama_w-disc_tumeX)*j+disc_margX, (tama_h-disc_tumeY)*i+tama_h/5, tama_w, tama_h);}}for(var j=0;j<6;j++){if(Select[j]!=0)ctx.drawImage(oyimage, tama_w*((Select[j]-1)%5), tama_h*Math.floor((Select[j]-1)/5), tama_w, tama_h, (tama_w-disc_tumeX)*j+disc_margX, select_margY+jumpY, tama_w, tama_h);}}function OneLine(){for(var i=6;i>0;i--){for(var j=0;j<6;j++){Board[i][j]=Board[i-1][j];}}for(var j=0;j<6;j++){var color=[1,2,3,4,5];do{var RAN=Math.floor(Math.random()*color.length);Board[0][j]=color[RAN];color.splice(RAN,1);num=0;LineCheck(j, 0);for(var m=0;m<7;m++){for(var n=0;n<6;n++){ChackBoard[m][n]=0;}}}while(num>2);}}
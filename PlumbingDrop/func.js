//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(x,y){if(Math.floor(gametime/1200)>=10)$("minfo").innerHTML = "";var i = Math.floor((y-disc_margY-top_marg)/tama_h);var j = Math.floor((x-disc_margX)/tama_w);if(i<0 )i=0;if(i>=6)i=5;if(j<0 )j=0;if(j>=6)j=5;Board[i][j]=Rotate[Board[i][j]];}function endPanelXY(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){bBoard[i][j]=0;}}linkEnd=[-1,-1];discCheck();if(linkEnd[0]!=-1){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(bBoard[i][j]==1)Board[i][j]+=30;}}drawTama();timer=0;flg = del;}return;}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg;if(y>150 && y<185 && x>80 && x<240){drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 150, 160, 40);ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = start;}else if(y>285 && y<315 && x>80 && x<240){drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);ctx.drawImage(aimage, 0, 0, 250, 50, 90, 308, 140, 8);btnFlg = link;}else{drawTama();ctx.drawImage(simage, 0, 0, 320, 320, 0, 0, 320, 320);btnFlg = ready;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg;drawTama();ctx.drawImage(ovimage, 0, 0, 320, 320, 0, 0, 320, 320);if(timer>5 && y>155 && y<185 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 155, 160, 35);btnFlg = start;}else if(timer>5 && y>195 && y<225 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 192, 160, 35);btnFlg = link;}else if(timer>5 && y>235 && y<275 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 232, 160, 35);btnFlg = open;}else if(timer>5 && y>280 && y<280+social_h && x>97 && x<97+social_w/2){ctx.drawImage(aimage, 0, 0, 250, 50, 92, 275, social_w/2+5, social_h+8);btnFlg = tweet;}else if(timer>5 && y>280 && y<280+social_h && x>97+social_w/2 && x<97+social_w){ctx.drawImage(aimage, 0, 0, 250, 50, 97+social_w/2, 275, social_w/2+5, social_h+8);btnFlg = face;}else{btnFlg = over;}ctx.drawImage(socialimage, 0, 0, social_w, social_h, 97, 280, social_w, social_h);}function clearButtonXY(sx,sy){var x=sx;var y=sy-top_marg;drawTama();if(timer>5 && y>155 && y<185 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 155, 160, 35);btnFlg = start;}else{btnFlg = clear;}ctx.drawImage(cimage, 0, 0, 320, 320, 0, 0, 320, 320);}function endButtonXY(){if(btnFlg==start && timer>10){Board =[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];bBoard=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];slideValue = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Dare = Stage%4;linkEnd=[-1,-1];if(flg==over)Stage=1;score=2+Stage;gametime = starttime;timer= 0;flg = btnFlg;}else if(btnFlg==open && timer>10){Board =[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];bBoard=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];slideValue = [[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];Dare = Stage%4;linkEnd=[-1,-1];Stage=1;score=2+Stage;gametime = starttime;timer=0;flg = btnFlg;}else if(btnFlg==link && timer>10){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>10 && btnFlg==tweet){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialtj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialt.php?id='+id+'&score='+s_score;}}else if(timer>10 && btnFlg==face){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialfj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialf.php?id='+id+'&score='+s_score;}}else{flg = btnFlg;}}function QuestionCreate(n){if(n>33)n==33;Board=[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]];var koho=[[0,0],[0,1],[0,2],[0,3],[0,4],[0,5],[1,0],[1,1],[1,2],[1,3],[1,4],[1,5],[2,0],[2,1],[2,2],[2,3],[2,4],[2,5],[3,0],[3,1],[3,2],[3,3],[3,4],[3,5],[4,0],[4,1],[4,2],[4,3],[4,4],[4,5],[5,0],[5,1],[5,2],[5,3],[5,4],[5,5]];var RAN=Math.floor(Math.random() * koho.length);Board[koho[RAN][0]][koho[RAN][1]]=Dare*4+14+Math.floor(Math.random()*4);koho.splice(RAN,1);for(var i=0;i<n+2;i++){var RAN=Math.floor(Math.random() * koho.length);Board[koho[RAN][0]][koho[RAN][1]]=10+Math.floor(Math.random()*4);koho.splice(RAN,1);}var Color=[1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,8,8,8,8,9,9,9,9];for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==0){var RAN=Math.floor(Math.random() * Color.length);Board[i][j]=Color[RAN];Color.splice(RAN,1);}}}discCheck();if(linkEnd[0]!=-1)Board[linkEnd[0]][linkEnd[1]]=Rotate[Board[linkEnd[0]][linkEnd[1]]];}function drawTama(){ctx.clearRect(0,0,320,320);for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]!=0){if(Board[i][j]>29){ctx.fillStyle = "#cff";ctx.fillRect(tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);ctx.drawImage(aniimage, tama_w*((Board[i][j]-1-30)%5), tama_h*Math.floor((Board[i][j]-1-30)/5), tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}else{ctx.drawImage(aniimage, tama_w*((Board[i][j]-1)%5), tama_h*Math.floor((Board[i][j]-1)/5), tama_w, tama_h, tama_w*j+disc_margX, tama_h*i+disc_margY, tama_w, tama_h);}}}}drawWaku();}function drawWaku(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==0)continue;ctx.save();ctx.translate(tama_w*(j+1/2)+disc_margX, tama_h*(i+1/2)+disc_margY);ctx.beginPath();ctx.moveTo(-tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,tama_h/2);ctx.lineWidth=0.5;ctx.strokeStyle="#999";ctx.stroke();ctx.restore();}}}function BoardClear(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){Board[i][j]=0;}}Direct=[0,1,2,3];count=0;}function discCheck(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==4*Dare+16){lineCheck(i,j+1,0);return;}else if(Board[i][j]==4*Dare+17){lineCheck(i+1,j,1);return;}else if(Board[i][j]==4*Dare+14){lineCheck(i,j-1,2);return;}else if(Board[i][j]==4*Dare+15){lineCheck(i-1,j,3);return;}}}}function lineCheck(i,j,d){if(i<0 || i>5 || j<0 || j>5){return;}bBoard[i][j]=1;if(Road[Board[i][j]][d]==0){lineCheck(i,j+1,0);}else if(Road[Board[i][j]][d]==1){lineCheck(i+1,j,1);}else if(Road[Board[i][j]][d]==2){lineCheck(i,j-1,2);}else if(Road[Board[i][j]][d]==3){lineCheck(i-1,j,3);}else if(Road[Board[i][j]][d]==4){return;}else if(Road[Board[i][j]][d]==5){linkEnd=[i,j];return;}}function drawSlide(){for(var i=0;i<6;i++){for(var j=0;j<6;j++){if(Board[i][j]==0)ctx.clearRect(tama_w*j+disc_margX,tama_h*i+disc_margY,tama_w,tama_h);if(slideValue[i][j]!=0){ctx.drawImage(aniimage, tama_w*((slideValue[i][j]-1)%5), tama_h*Math.floor((slideValue[i][j]-1)/5), tama_w, tama_h, tama_w*j+disc_margX, tama_h*(i-1)+15*timer+disc_margY, tama_w, tama_h);slideWaku(i,j);}}}}function slideWaku(i,j){ctx.save();ctx.translate(tama_w*(j+1/2)+disc_margX, tama_h*(i-1/2)+15*timer+disc_margY);ctx.beginPath();ctx.moveTo(-tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,tama_h/2);ctx.lineTo(tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,-tama_h/2);ctx.lineTo(-tama_w/2,tama_h/2);ctx.lineWidth=0.5;ctx.strokeStyle="#999";ctx.stroke();ctx.restore();}function createTime(){var date_obj = new Date();gametime = date_obj.getTime() - time;gametime = starttime - gametime;}function socialHenkan(){if(document.documentElement.lang == 'ja'){s_score=(Stage-1)+" ステージクリア! (^^)v 『"+title+"』";}else{s_score=(Stage-1)+" Stages Clear! ["+title+"]";}s_score=encodeURI(s_score);}
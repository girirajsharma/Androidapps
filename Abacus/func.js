//Copyright (C) Webbu Kobo Tokyo Japan All Rights Reserved
function $(id){return document.getElementById(id);}function touchPanelXY(sx,sy){var x=sx;var y=sy-top_marg-top_tamarg;if(y>0 && y<tama_h*2){var j = Math.floor(x/tama_w);var i = Math.floor(y/tama_h);if(x/tama_w-j<0.1 || x/tama_w-j>0.9)return;if(value[i][j]==0)return;if(move[i][j]==1)return;var cnt=0;for(var m=0;m<2;m++){if(value[m][j]==0 && cnt==0){value[m][j]=1;value[i][j]=0;drawTama();cnt++;}move[m][j] = 1;}}else if(y>tama_h*2+rail_height && y<tama_h*7+rail_height){var j = Math.floor(x/tama_w);var i = Math.floor((y-rail_height)/tama_h);if(x/tama_w-j<0.1 || x/tama_w-j>0.9)return;if(value[i][j]==0)return;if(move[i][j]==1)return;var cnt=0;for(var m=2;m<7;m++){if(value[m][j]==0 && cnt==0){value[m][j]=1;value[i][j]=0;drawTama();cnt++;}move[m][j] = 1;}}point = 0;for (var i=0; i<7; i++) {for (var j=0; j<4; j++) {if(value[i][j]==0){point += num[i][j]*Math.pow(10,3-j);}}}if(flg==5){flg=6;return;}if(point==sum){$("minfo").innerHTML = "CORRECT!";vpoint = point;score++;timer=0;if(sum < 1000){while(true){qnum = Math.floor(Math.random()*990)+9;if(qnum != oldq)break;}}else{while(true){var plumin = Math.floor(Math.random()*2)-1;qnum = plumin * Math.floor(Math.random()*990)+9;if(qnum != 9 && qnum != oldq)break;}}oldq = qnum;sum += qnum;flg = 3;}if(flg==1)flg=2;}function startButtonXY(sx,sy){var x=sx;var y=sy-top_marg-top_tamarg;if(y>130 && y<170 && x>80 && x<240){drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 135+top_marg, 160, 32);ctx.drawImage(simage, 0, 0, 512, 512, -5, -5, 330, 330);btnFlg = 0;}else if(y>170 && y<210 && x>80 && x<240){drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 80, 175+top_marg, 160, 32);ctx.drawImage(simage, 0, 0, 512, 512, -5, -5, 330, 330);btnFlg = 5;}else if(y>250 && y<290 && x>80 && x<240){drawTama();ctx.drawImage(aimage, 0, 0, 250, 50, 90, 282, 140, 25);ctx.drawImage(simage, 0, 0, 512, 512, -5, -5, 330, 330);btnFlg = 7;}else{drawTama();ctx.drawImage(simage, 0, 0, 512, 512, -5, -5, 330, 330);btnFlg = -2;}}function touchButtonXY(sx,sy){var x=sx;var y=sy-top_marg-top_tamarg;drawTama();ctx.drawImage(ovimage, 0, 0, 512, 512, -5, -5, 330, 330);if(timer>5 && y>130 && y<170 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 135+top_marg, 160, 32);btnFlg = 0;}else if(timer>5 && y>170 && y<210 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 175+top_marg, 160, 32);btnFlg = 7;}else if(timer>5 && y>210 && y<250 && x>80 && x<240){ctx.drawImage(aimage, 0, 0, 250, 50, 80, 215+top_marg, 160, 32);btnFlg = -3;}else if(timer>5 && y>260 && y<260+social_h && x>97 && x<97+social_w/2){ctx.drawImage(aimage, 0, 0, 250, 50, 92, 275, social_w/2+5, social_h+8);btnFlg = 8;}else if(timer>5 && y>260 && y<260+social_h && x>97+social_w/2 && x<97+social_w){ctx.drawImage(aimage, 0, 0, 250, 50, 97+social_w/2, 275, social_w/2+5, social_h+8);btnFlg = 9;}else{btnFlg = 4;}ctx.drawImage(socialimage, 0, 0, social_w, social_h, 97, 280, social_w, social_h);}function endPanelXY(){for(var i=0;i<7;i++){for(var j=0;j<4;j++){move[i][j] = 0;}}point = 0;for (var i=0; i<7; i++) {for (var j=0; j<4; j++) {if(value[i][j]==0){point += num[i][j]*Math.pow(10,3-j);}}}if(flg==2)flg = 1;if(flg==6)flg = 5;}function endButtonXY(){if(timer>5 && btnFlg==0){move = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];value = [[1,1,1,1],[0,0,0,0],[0,0,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]];point = 0;vpoint= 0;qnum = 0;snum = 0;score= 0;timer=0;gametime=starttime;flg = btnFlg;}else if(timer>5 && btnFlg==-3){move = [[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];value = [[1,1,1,1],[0,0,0,0],[0,0,0,0],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]];point = 0;vpoint= 0;qnum = 0;snum = 0;score= 0;timer=0;gametime=starttime;$("minfo").innerHTML = "";flg = btnFlg;}else if( btnFlg==5){drawTama();flg = btnFlg;}else if(timer>5 && btnFlg==7){if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/';}else{top.location.href='http://game-cafe.net/';}}else if(timer>5 && btnFlg==8){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialtj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialt.php?id='+id+'&score='+s_score;}}else if(timer>5 && btnFlg==9){socialHenkan();if(document.documentElement.lang == 'ja'){top.location.href='http://ja.game-cafe.net/socialfj.php?id='+id+'&score='+s_score;}else{top.location.href='http://game-cafe.net/socialf.php?id='+id+'&score='+s_score;}}else if(timer>5){flg = btnFlg;}}function drawTama(){ctx.drawImage(bimage, x_marg, y_marg, 512, 512, -79, -50, 400, 400);for(var i=0;i<7;i++){for(var j=0;j<4;j++){if(value[i][j]==1){var h=top_tamarg;if(i>1){h=top_tamarg+rail_height;}ctx.drawImage(timage, 0, 0, 512/5, 50, tama_w*j, tama_h*i+h, tama_w, tama_h);}}}}function createTime(){var date_obj = new Date();gametime = date_obj.getTime() - time;gametime = starttime - gametime;}function socialHenkan(){if(document.documentElement.lang == 'ja'){s_score="スコア:"+score+"! 『"+title+"』";}else{s_score="SCORE:"+score+"! ["+title+"]";}s_score=encodeURI(s_score);}